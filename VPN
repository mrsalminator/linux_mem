https://habr.com/ru/companies/ruvds/articles/498924/

https://github.com/jawj/IKEv2-setup 

# запуск автоматической установки сервера IKEv2 
wget https://raw.githubusercontent.com/jawj/IKEv2-setup/master/setup.sh
chmod u+x setup.sh
./setup.sh
....
# Введите имя домена направленного на IP-адрес сервера
# используйте сервис sslip.io если у вас нет домена
# Hostname for VPN: 123-45-67-89.sslip.io - вот тут к ip vps сервака просто добавляем .sslip.io, получается 89.110.102.150.sslip.io
Hostname for VPN: 123-45-67-89.sslip.io
# Имя пользователя VPN
VPN username: coolguy
# пароль 
VPN password (no quotes, please):
....
# скрипт запрос создать нового SSH-пользователя, этот шаг нельзя пропускать.

Шаг 3: Настройка клиента

На айфон нужно профиль скачать и только после этого заработает, профиль лежит на серваки, или на моем ядиске. Так же надо телодвижения делать и на др платформах.

Шаг 4: Добавление новых пользователей

Чтобы добавить нового пользователя в уже созданный сервер, отредактируйте файл /etc/ipsec.secrets.

# nano /etc/ipsec.secrets
123-45-67-89.sslip.io : RSA "privkey.pem"
coolguy : EAP "C00lPassword"
badguy : EAP "bAdP$$word"


Arch Linux/Ubuntu


Управление VPN:
Чтобы включить или выключить VPN после настройки, используйте следующие команды:

Включение (подключение) VPN:
sudo ipsec up ikev2vpn

Выключение (отключение) VPN:
sudo ipsec down ikev2vpn

Проверка состояния VPN:
sudo ipsec statusall
Эти команды позволят вам управлять VPN-соединением

Автозапуск:

Что бы каждый раз не запускать скрипт, нужно добавить сервис в автозапуск 

sudo systemctl enable strongswan-starter.service

отключить strongswan, они конфликтуют с strongswan-starter

sudo systemctl disable strongswan

Проверить конфиг ipsec, что он в автозапуске по пути /etc/ipsec.conf (auto=start)


Если не отключается вход по паролю:

Проверьте, есть ли файлы внутри /etc/ssh / sshd_config.d , присутствует ли какой-либо конфигурационный файл; если PasswordAuthentication yes найден, вы можете удалить такую строку. 
В Ubuntu 22.04.1 LTS iso я обнаружил, что /etc/ssh/sshd_config.d/50-cloud-init.conf переопределяет файл sshd_config, в котором включена аутентификация паролем.

Если нужно будет добавить закрытый ключ на машинку с которой хочешь подключиться к удаленной, то:

Подход 3: Добавление нового ключа в SSH-агент
Если вы хотите использовать оба ключа, можете добавить новый ключ в SSH-агент.

Запустите SSH-агент (если он не запущен):

sh
Копировать код
eval "$(ssh-agent -s)"
Добавьте новый ключ в SSH-агент:

sh
Копировать код
ssh-add ~/.ssh/id_rsa_new
Замените id_rsa_new на имя нового ключа.

Проверьте список добавленных ключей:

sh
Копировать код
ssh-add -l







